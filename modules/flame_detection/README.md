# Flame Detectionï¼ˆç‚ä¸Šæ¤œçŸ¥ï¼‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

ç‚ä¸Šæ¤œçŸ¥AIãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ãƒ»äºˆæ¸¬ãƒ»è©•ä¾¡ã‚’è¡Œã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€‚

## ğŸ“‚ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
flame_detection/
â”œâ”€â”€ label_windows.py              # ç‚ä¸ŠæœŸé–“ãƒ©ãƒ™ãƒªãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ label_config.yaml             # ãƒ©ãƒ™ãƒªãƒ³ã‚°è¨­å®šï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
â”œâ”€â”€ label_config_matsumoto.yaml   # æ¾æœ¬äººå¿—ã‚±ãƒ¼ã‚¹ã®è¨­å®š
â”œâ”€â”€ train_classifier.py           # åˆ†é¡ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ âœ…
â”œâ”€â”€ predict.py                    # ç‚ä¸Šäºˆæ¸¬ï¼ˆä½œæˆäºˆå®šï¼‰
â”œâ”€â”€ evaluate.py                   # ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ï¼ˆä½œæˆäºˆå®šï¼‰
â”œâ”€â”€ shap_analysis.py              # SHAPåˆ†æï¼ˆä½œæˆäºˆå®šï¼‰
â”œâ”€â”€ model/                        # å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ outputs/                      # äºˆæ¸¬çµæœãƒ»è©•ä¾¡çµæœ
â””â”€â”€ README.md                     # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸ·ï¸ ç‚ä¸ŠæœŸé–“ãƒ©ãƒ™ãƒªãƒ³ã‚° (`label_windows.py`)

### ç›®çš„

æ™‚ç³»åˆ—ç‰¹å¾´é‡ãƒ‡ãƒ¼ã‚¿ï¼ˆ`feature_table.csv`ï¼‰ã«å¯¾ã—ã¦ã€æŒ‡å®šã—ãŸæœŸé–“ã‚’ã€Œç‚ä¸Šã€ã¨ã—ã¦ãƒ©ãƒ™ãƒ«ä»˜ã‘ã™ã‚‹ã€‚

### æ©Ÿèƒ½

- YAMLè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç‚ä¸ŠæœŸé–“ã‚’èª­ã¿è¾¼ã¿
- timestampåˆ—ã‚’åŸºæº–ã«æœŸé–“åˆ¤å®š
- `is_controversy` åˆ—ã‚’è¿½åŠ ï¼ˆ1=ç‚ä¸Š, 0=éç‚ä¸Šï¼‰
- è¤‡æ•°æœŸé–“å¯¾å¿œï¼ˆORæ¡ä»¶ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆtimestampè§£æã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰

### ä½¿ã„æ–¹

#### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```bash
cd modules/flame_detection

python label_windows.py \
  <å…¥åŠ›CSV> \
  <è¨­å®šYAML> \
  <å‡ºåŠ›CSV>
```

#### å…·ä½“ä¾‹

```bash
# æ¾æœ¬äººå¿—ã®ãƒ‡ãƒ¼ã‚¿ã«ãƒ©ãƒ™ãƒ«ä»˜ã‘
python label_windows.py \
  ../feature_engineering/outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_feature_table.csv \
  label_config_matsumoto.yaml \
  outputs/æ¾æœ¬äººå¿—_labeled.csv
```

#### ãƒ˜ãƒ«ãƒ—è¡¨ç¤º

```bash
python label_windows.py --help
```

### å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«

#### 1. ç‰¹å¾´é‡CSVï¼ˆå¿…é ˆï¼‰

`feature_table.csv` - ç‰¹å¾´é‡çµ±åˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‡ºåŠ›

**å¿…é ˆã‚«ãƒ©ãƒ **:
- `timestamp` - æ—¥æ™‚ï¼ˆISO8601 or "YYYY-MM-DD HH:MM:SS"ï¼‰

**ãã®ä»–ã®ã‚«ãƒ©ãƒ **ï¼ˆä»»æ„ï¼‰:
- `volume`, `negative_rate`, `stance_against_rate`, `delta_volume`, etc.

**ä¾‹**:
```csv
timestamp,volume,negative_rate,stance_against_rate,delta_volume
2025-10-31 14:00:00,2,1.0,0.5,0.0
2025-10-31 15:00:00,0,0.0,0.0,-2.0
2025-10-31 16:00:00,1,1.0,1.0,1.0
```

#### 2. è¨­å®šYAML

ç‚ä¸ŠæœŸé–“ã‚’å®šç¾©ã™ã‚‹YAMLãƒ•ã‚¡ã‚¤ãƒ«

**ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**:
```yaml
controversy_periods:
  - start: "2023-12-18 00:00:00"
    end: "2023-12-20 23:59:59"
    label: "äº‹ä¾‹1"              # ã‚ªãƒ—ã‚·ãƒ§ãƒ³
    description: "èª¬æ˜æ–‡"        # ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  
  - start: "2024-01-05 12:00:00"
    end: "2024-01-06 02:00:00"
    label: "äº‹ä¾‹2"
```

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¬æ˜**:
- `start`: ç‚ä¸Šé–‹å§‹æ—¥æ™‚ï¼ˆå¿…é ˆï¼‰
- `end`: ç‚ä¸Šçµ‚äº†æ—¥æ™‚ï¼ˆå¿…é ˆï¼‰
- `label`: æœŸé–“åï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ãƒ­ã‚°è¡¨ç¤ºç”¨ï¼‰
- `description`: èª¬æ˜æ–‡ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ãƒ­ã‚°è¡¨ç¤ºç”¨ï¼‰

### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

ãƒ©ãƒ™ãƒ«ä»˜ãç‰¹å¾´é‡CSV

**è¿½åŠ ã‚«ãƒ©ãƒ **:
- `is_controversy` - ç‚ä¸Šãƒ•ãƒ©ã‚°ï¼ˆ1=ç‚ä¸Š, 0=éç‚ä¸Šï¼‰

**ä¾‹**:
```csv
timestamp,volume,negative_rate,stance_against_rate,delta_volume,is_controversy
2025-10-31 14:00:00,2,1.0,0.5,0.0,1
2025-10-31 15:00:00,0,0.0,0.0,-2.0,1
2025-10-31 16:00:00,1,1.0,1.0,1.0,1
2025-11-01 00:00:00,0,0.0,0.0,-1.0,0
```

### ãƒ©ãƒ™ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯

```python
# å„ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦
for record in records:
    is_controversy = 0
    
    # å„ç‚ä¸ŠæœŸé–“ã«ã¤ã„ã¦åˆ¤å®šï¼ˆORæ¡ä»¶ï¼‰
    for period in controversy_periods:
        if period.start <= record.timestamp <= period.end:
            is_controversy = 1
            break
    
    record['is_controversy'] = is_controversy
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

| ã‚¨ãƒ©ãƒ¼ | å‡¦ç† |
|--------|------|
| è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãªã— | ä¾‹å¤–é€å‡ºãƒ»çµ‚äº† |
| `timestamp`åˆ—ãªã— | ä¾‹å¤–é€å‡ºãƒ»çµ‚äº† |
| timestampè§£æã‚¨ãƒ©ãƒ¼ | è­¦å‘Šè¡¨ç¤ºãƒ»è©²å½“è¡Œã‚¹ã‚­ãƒƒãƒ— |
| start > end | è­¦å‘Šè¡¨ç¤ºãƒ»è©²å½“æœŸé–“ã‚¹ã‚­ãƒƒãƒ— |
| ç‚ä¸ŠæœŸé–“æœªå®šç¾© | å…¨ã¦ `is_controversy=0` |

### å‡ºåŠ›ä¾‹

```
============================================================
ç‚ä¸ŠæœŸé–“ãƒ©ãƒ™ãƒªãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
============================================================

ğŸ“– è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­: label_config_matsumoto.yaml
  æœŸé–“ 1: 2025-10-31 14:00:00 ã€œ 2025-11-02 23:59:59
    èª¬æ˜: æŠ•ç¨¿æ€¥å¢—ãƒ»ãƒã‚¬ãƒ†ã‚£ãƒ–ç‡ä¸Šæ˜‡æœŸ
  æœŸé–“ 2: 2025-11-04 00:00:00 ã€œ 2025-11-05 12:00:00
    èª¬æ˜: æ‰¹åˆ¤çš„æŠ•ç¨¿ã®å†å¢—åŠ 
âœ“ 2å€‹ã®ç‚ä¸ŠæœŸé–“ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ

ğŸ“Š ç‰¹å¾´é‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­: æ¾æœ¬äººå¿—_feature_table.csv
âœ“ 273ä»¶ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ

ğŸ• timestampåˆ—ã‚’è§£æä¸­...
âœ“ ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç¯„å›²: 2025-10-31 14:00:00 ã€œ 2025-11-11 22:00:00

ğŸ·ï¸  ãƒ©ãƒ™ãƒ«ä»˜ã‘å‡¦ç†ä¸­...
  æœŸé–“ 1 (åˆæœŸç‚ä¸Š): 58ä»¶ã‚’ç‚ä¸Šã¨ã—ã¦ãƒ©ãƒ™ãƒ«ä»˜ã‘
  æœŸé–“ 2 (å†ç‡ƒæœŸ): 36ä»¶ã‚’ç‚ä¸Šã¨ã—ã¦ãƒ©ãƒ™ãƒ«ä»˜ã‘

âœ“ ãƒ©ãƒ™ãƒ«ä»˜ã‘å®Œäº†:
  ç‚ä¸Š (is_controversy=1): 94ä»¶ (34.4%)
  éç‚ä¸Š (is_controversy=0): 179ä»¶ (65.6%)

ğŸ’¾ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ä¸­: outputs/æ¾æœ¬äººå¿—_labeled.csv
âœ“ ä¿å­˜å®Œäº† (273ä»¶)

============================================================
âœ… ã™ã¹ã¦ã®å‡¦ç†ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼
============================================================
```

## ğŸ”§ ç‚ä¸ŠæœŸé–“ã®æ±ºã‚æ–¹

### æ‰‹é †

1. **ç‰¹å¾´é‡ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–**
   ```bash
   # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰å®Ÿè¡Œ
   python visualize_features.py \
     modules/feature_engineering/outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_feature_table.csv \
     modules/flame_detection/feature_trends.png
   ```

   ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ãŒå‡ºåŠ›ã•ã‚Œã¾ã™:
   - 5ã¤ã®ã‚°ãƒ©ãƒ•ï¼ˆæŠ•ç¨¿é‡ã€ãƒã‚¬ãƒ†ã‚£ãƒ–ç‡ã€æ‰¹åˆ¤ç‡ã€å¤‰åŒ–é‡ã€ç‚ä¸Šã‚¹ã‚³ã‚¢ï¼‰
   - æ³¨ç›®ã™ã¹ãæ™‚é–“å¸¯ã®ä¸€è¦§
   - æ¨å¥¨ãƒ©ãƒ™ãƒªãƒ³ã‚°æœŸé–“

2. **ç‚ä¸Šã®å…†å€™ã‚’ç‰¹å®š**
   - æŠ•ç¨¿é‡ã®æ€¥å¢—ï¼ˆ`volume`, `delta_volume`ãŒå¤§ãã„ï¼‰
   - ãƒã‚¬ãƒ†ã‚£ãƒ–ç‡ã®ä¸Šæ˜‡ï¼ˆ`negative_rate` > 0.7ï¼‰
   - æ‰¹åˆ¤çš„ç«‹å ´ã®å¢—åŠ ï¼ˆ`stance_against_rate` > 0.5ï¼‰

3. **æœŸé–“ã‚’è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°**
   ```yaml
   controversy_periods:
     - start: "2025-11-01 12:00:00"  # æ€¥å¢—é–‹å§‹
       end: "2025-11-02 18:00:00"    # æ²ˆé™åŒ–
       label: "ç‚ä¸Šãƒ”ãƒ¼ã‚¯"
   ```

4. **ãƒ©ãƒ™ãƒªãƒ³ã‚°å®Ÿè¡Œï¼†ç¢ºèª**
   ```bash
   python label_windows.py feature_table.csv label_config.yaml labeled.csv
   
   # çµæœç¢ºèª
   python -c "import pandas as pd; df = pd.read_csv('labeled.csv'); print(df['is_controversy'].value_counts())"
   ```

---

## ğŸ¤– åˆ†é¡ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ (`train_classifier.py`)

### ç›®çš„

ãƒ©ãƒ™ãƒ«ä»˜ãç‰¹å¾´é‡ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç‚ä¸Šã‚’äºˆæ¸¬ã™ã‚‹2å€¤åˆ†é¡ãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’ã—ã¾ã™ã€‚

### æ©Ÿèƒ½

- **è‡ªå‹•ç‰¹å¾´é‡é¸æŠ**: timestampä»¥å¤–ã®æ•°å€¤åˆ—ã‚’è‡ªå‹•ã§ç‰¹å¾´é‡ã¨ã—ã¦ä½¿ç”¨
- **ãƒ¢ãƒ‡ãƒ«é¸æŠ**: XGBoost or RandomForest
- **ã‚¯ãƒ©ã‚¹ä¸å‡è¡¡å¯¾ç­–**: scale_pos_weightè‡ªå‹•èª¿æ•´
- **è©•ä¾¡æŒ‡æ¨™**: Accuracy, Precision, Recall, F1, AUC
- **å¯è¦–åŒ–**: æ··åŒè¡Œåˆ—ã€ROCæ›²ç·šã€ç‰¹å¾´é‡é‡è¦åº¦
- **ãƒ¢ãƒ‡ãƒ«ä¿å­˜**: pickleå½¢å¼ã§ä¿å­˜

### ä½¿ã„æ–¹

#### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•ï¼ˆXGBoostï¼‰

```bash
cd modules/flame_detection

python train_classifier.py \
  outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_labeled.csv \
  outputs/æ¾æœ¬äººå¿—/model/
```

#### RandomForestã‚’ä½¿ç”¨

```bash
python train_classifier.py \
  outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_labeled.csv \
  outputs/æ¾æœ¬äººå¿—/model_rf/ \
  --model randomforest
```

#### ãƒ†ã‚¹ãƒˆã‚µã‚¤ã‚ºã‚’å¤‰æ›´

```bash
python train_classifier.py \
  labeled.csv \
  output/ \
  --test-size 0.3  # 30%ã‚’ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«
```

#### ãƒ˜ãƒ«ãƒ—è¡¨ç¤º

```bash
python train_classifier.py --help
```

### å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«

ãƒ©ãƒ™ãƒ«ä»˜ãç‰¹å¾´é‡CSVï¼ˆ`label_windows.py`ã®å‡ºåŠ›ï¼‰

**å¿…é ˆã‚«ãƒ©ãƒ **:
- `is_controversy` - æ•™å¸«ãƒ©ãƒ™ãƒ«ï¼ˆ0=éç‚ä¸Š, 1=ç‚ä¸Šï¼‰

**ç‰¹å¾´é‡ã‚«ãƒ©ãƒ ï¼ˆè‡ªå‹•æ¤œå‡ºï¼‰**:
- `volume`, `negative_rate`, `stance_against_rate`, etc.
- timestampåˆ—ã¯è‡ªå‹•ã§é™¤å¤–ã•ã‚Œã‚‹

### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|------|
| `model.pkl` | å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ï¼ˆpickleå½¢å¼ï¼‰ |
| `evaluation.txt` | è©•ä¾¡æŒ‡æ¨™ã®è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ |
| `evaluation_metrics.png` | æ··åŒè¡Œåˆ—ã¨ROCæ›²ç·š |
| `feature_importance.png` | ç‰¹å¾´é‡é‡è¦åº¦ã‚°ãƒ©ãƒ• |
| `feature_importance.csv` | ç‰¹å¾´é‡é‡è¦åº¦ãƒ‡ãƒ¼ã‚¿ |
| `model_info.txt` | ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |

### å­¦ç¿’ãƒ—ãƒ­ã‚»ã‚¹

```python
# 1. ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
df = pd.read_csv('labeled.csv')

# 2. ç‰¹å¾´é‡æº–å‚™
X = df[æ•°å€¤åˆ—ï¼ˆtimestampé™¤å¤–ï¼‰]
y = df['is_controversy']

# 3. å­¦ç¿’ãƒ»ãƒ†ã‚¹ãƒˆåˆ†å‰²ï¼ˆ80/20ã€å±¤åŒ–æŠ½å‡ºï¼‰
X_train, X_test, y_train, y_test = train_test_split(...)

# 4. ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ï¼ˆã‚¯ãƒ©ã‚¹é‡ã¿è‡ªå‹•èª¿æ•´ï¼‰
model = XGBClassifier(scale_pos_weight=n_negative/n_positive)
model.fit(X_train, y_train)

# 5. è©•ä¾¡
y_pred = model.predict(X_test)
è©•ä¾¡æŒ‡æ¨™ã‚’è¨ˆç®—ãƒ»ä¿å­˜

# 6. å¯è¦–åŒ–ãƒ»ä¿å­˜
ç‰¹å¾´é‡é‡è¦åº¦ã€æ··åŒè¡Œåˆ—ã€ROCæ›²ç·šã‚’ä¿å­˜
```

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

#### XGBoostï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

```python
XGBClassifier(
    n_estimators=100,        # æœ¨ã®æœ¬æ•°
    max_depth=5,             # æœ¨ã®æ·±ã•
    learning_rate=0.1,       # å­¦ç¿’ç‡
    scale_pos_weight=è‡ªå‹•,   # ã‚¯ãƒ©ã‚¹é‡ã¿
    random_state=42
)
```

#### RandomForest

```python
RandomForestClassifier(
    n_estimators=100,        # æœ¨ã®æœ¬æ•°
    max_depth=10,            # æœ¨ã®æ·±ã•
    class_weight='balanced', # ã‚¯ãƒ©ã‚¹é‡ã¿è‡ªå‹•èª¿æ•´
    random_state=42
)
```

### è©•ä¾¡æŒ‡æ¨™ã®è¦‹æ–¹

#### Accuracyï¼ˆæ­£è§£ç‡ï¼‰
- å…¨ä½“ã®ã†ã¡æ­£ã—ãäºˆæ¸¬ã§ããŸå‰²åˆ
- **æ³¨æ„**: ã‚¯ãƒ©ã‚¹ä¸å‡è¡¡æ™‚ã¯å‚è€ƒç¨‹åº¦

#### Precisionï¼ˆé©åˆç‡ï¼‰
- ã€Œç‚ä¸Šã€ã¨äºˆæ¸¬ã—ãŸã†ã¡ã€å®Ÿéš›ã«ç‚ä¸Šã ã£ãŸå‰²åˆ
- **é«˜ã„â†’èª¤å ±ãŒå°‘ãªã„**

#### Recallï¼ˆå†ç¾ç‡ï¼‰
- å®Ÿéš›ã®ç‚ä¸Šã®ã†ã¡ã€æ­£ã—ãæ¤œçŸ¥ã§ããŸå‰²åˆ
- **é«˜ã„â†’è¦‹é€ƒã—ãŒå°‘ãªã„**

#### F1-Score
- Precisionã¨Recallã®èª¿å’Œå¹³å‡
- **ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„æŒ‡æ¨™**

#### AUCï¼ˆROCæ›²ç·šä¸‹é¢ç©ï¼‰
- 0.5ã€œ1.0ã®å€¤ï¼ˆ0.5=ãƒ©ãƒ³ãƒ€ãƒ ã€1.0=å®Œç’§ï¼‰
- **0.8ä»¥ä¸Šã§è‰¯å¥½**

### å®Ÿè¡Œä¾‹ã¨çµæœ

#### æ¾æœ¬äººå¿—ã‚±ãƒ¼ã‚¹ï¼ˆXGBoostï¼‰

```bash
python train_classifier.py \
  outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_labeled.csv \
  outputs/æ¾æœ¬äººå¿—/model/
```

**çµæœ**:
```
ãƒ‡ãƒ¼ã‚¿: 273ä»¶ (ç‚ä¸Š54ä»¶ã€éç‚ä¸Š219ä»¶)
ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿: 55ä»¶

è©•ä¾¡æŒ‡æ¨™:
  Accuracy:  0.8364
  Precision: 0.6000
  Recall:    0.5455
  F1-Score:  0.5714
  AUC:       0.7975

æ··åŒè¡Œåˆ—:
  True Negative:  40 (æ­£ã—ãéç‚ä¸Š)
  False Positive: 4  (èª¤ã£ã¦ç‚ä¸Šã¨äºˆæ¸¬)
  False Negative: 5  (è¦‹é€ƒã—)
  True Positive:  6  (æ­£ã—ãç‚ä¸Šæ¤œçŸ¥)

ç‰¹å¾´é‡é‡è¦åº¦ Top 3:
  1. negative_rate: 0.3078
  2. stance_against_mean: 0.1773
  3. delta_negative_rate: 0.1574
```

**è§£é‡ˆ**:
- âœ… **Accuracy 83.6%**: å…¨ä½“çš„ã«è‰¯å¥½
- âš ï¸ **Recall 54.5%**: ç‚ä¸Šã®ç´„åŠåˆ†ã‚’è¦‹é€ƒã—
- âœ… **AUC 0.80**: è‰¯å¥½ãªåˆ¤åˆ¥æ€§èƒ½
- ğŸ’¡ **é‡è¦ãªç‰¹å¾´é‡**: ãƒã‚¬ãƒ†ã‚£ãƒ–ç‡ã€æ‰¹åˆ¤çš„ç«‹å ´ã®å¹³å‡ã‚¹ã‚³ã‚¢

---

## ğŸ“ˆ ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ã®æ”¹å–„æ–¹æ³•

### 1. ãƒ‡ãƒ¼ã‚¿é‡ã‚’å¢—ã‚„ã™
- ä»–ã®ãƒˆãƒ”ãƒƒã‚¯ï¼ˆå°æ¹¾æœ‰äº‹ã€å¯¿å¸ãƒšãƒ­ãªã©ï¼‰ã‚‚å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ 
- ã‚ˆã‚Šå¤šæ§˜ãªã‚±ãƒ¼ã‚¹ã§æ±åŒ–æ€§èƒ½å‘ä¸Š

### 2. ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´

```bash
# GridSearchCV ã‚„ Optunaã‚’ä½¿ç”¨
# ä¾‹: max_depth, learning_rate, n_estimators ã‚’æœ€é©åŒ–
```

### 3. ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°

```python
# è¿½åŠ ã§ãã‚‹ç‰¹å¾´é‡:
- ç§»å‹•å¹³å‡ï¼ˆ3æ™‚é–“ã€6æ™‚é–“ï¼‰
- åŠ é€Ÿåº¦ï¼ˆ2æ¬¡å¾®åˆ†ï¼‰
- æ™‚é–“å¸¯ãƒ•ãƒ©ã‚°ï¼ˆæ·±å¤œã€æ˜¼é–“ï¼‰
- æ›œæ—¥ãƒ•ãƒ©ã‚°
```

### 4. é–¾å€¤èª¿æ•´

```python
# Recallã‚’é‡è¦–ã™ã‚‹å ´åˆï¼ˆè¦‹é€ƒã—ã‚’æ¸›ã‚‰ã™ï¼‰
y_pred_proba = model.predict_proba(X_test)[:, 1]
y_pred_adjusted = (y_pred_proba > 0.3).astype(int)  # é–¾å€¤ã‚’ä¸‹ã’ã‚‹
```

### 5. ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«

```python
# XGBoost + RandomForest + LightGBM ã®æŠ•ç¥¨
from sklearn.ensemble import VotingClassifier
```

---

## ğŸ“Š ã‚¯ãƒ©ã‚¹ä¸å‡è¡¡ã¸ã®å¯¾å‡¦

ç‚ä¸ŠæœŸé–“ã¯é€šå¸¸ã€éç‚ä¸ŠæœŸé–“ã‚ˆã‚ŠçŸ­ã„ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ãŒä¸å‡è¡¡ã«ãªã‚Šã¾ã™ã€‚

### æ¨å¥¨å¯¾ç­–

1. **SMOTEï¼ˆã‚ªãƒ¼ãƒãƒ¼ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ï¼‰**
   ```python
   from imblearn.over_sampling import SMOTE
   ```

2. **ã‚¯ãƒ©ã‚¹é‡ã¿èª¿æ•´**
   ```python
   # XGBoostã®å ´åˆ
   scale_pos_weight = (non_controversy_count / controversy_count)
   ```

3. **è©•ä¾¡æŒ‡æ¨™ã®å·¥å¤«**
   - Accuracy ã§ã¯ãªã **F1-Score** ã‚’é‡è¦–
   - Precision-Recallæ›²ç·šã§è©•ä¾¡

## ğŸ”„ å®Œå…¨ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä¾‹

```bash
# 1. ç‰¹å¾´é‡ç”Ÿæˆ
cd ../feature_engineering
python feature_builder.py \
  --sentiment_csv ../sentiment_analysis/dictionary_based/outputs/æ¾æœ¬äººå¿—_sentiment_1h.csv \
  --stance_csv ../stance_detection/outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_stance.csv

# 2. å¯è¦–åŒ–ã—ã¦ç‚ä¸ŠæœŸé–“ã‚’ç¢ºèª
cd ../../
python visualize_features.py \
  modules/feature_engineering/outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_feature_table.csv \
  modules/flame_detection/feature_trends.png

# 3. ãƒ©ãƒ™ãƒªãƒ³ã‚°è¨­å®šã‚’ç·¨é›†
# label_config_matsumoto.yaml ã‚’å¯è¦–åŒ–çµæœã«åŸºã¥ã„ã¦ç·¨é›†

# 4. ãƒ©ãƒ™ãƒªãƒ³ã‚°
cd modules/flame_detection
python label_windows.py \
  ../feature_engineering/outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_feature_table.csv \
  label_config_matsumoto.yaml \
  outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_labeled.csv

# 5. ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ï¼ˆXGBoostï¼‰
python train_classifier.py \
  outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_labeled.csv \
  outputs/æ¾æœ¬äººå¿—/model/

# 6. ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ï¼ˆRandomForest - æ¯”è¼ƒç”¨ï¼‰
python train_classifier.py \
  outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_labeled.csv \
  outputs/æ¾æœ¬äººå¿—/model_rf/ \
  --model randomforest

# 7. çµæœç¢ºèª
cat outputs/æ¾æœ¬äººå¿—/model/evaluation.txt
cat outputs/æ¾æœ¬äººå¿—/model_rf/evaluation.txt
```

---

## âš ï¸ æ³¨æ„äº‹é …

- **ä¸»è¦³çš„ãªãƒ©ãƒ™ãƒªãƒ³ã‚°**: ç‚ä¸Šã®å®šç¾©ã¯ä¸»è¦³çš„ã§ã™ã€‚æ˜ç¢ºãªåŸºæº–ã‚’è¨­å®šã—ã¦ãã ã•ã„
- **æ™‚é–“ç²’åº¦**: 1æ™‚é–“å˜ä½ã§ã®åˆ¤å®šã®ãŸã‚ã€å¢ƒç•ŒãŒæ›–æ˜§ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™
- **è¤‡æ•°ãƒˆãƒ”ãƒƒã‚¯**: ãƒˆãƒ”ãƒƒã‚¯ã”ã¨ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†ã‘ã‚‹ã“ã¨ã‚’æ¨å¥¨
- **ã‚¯ãƒ©ã‚¹ä¸å‡è¡¡**: æ©Ÿæ¢°å­¦ç¿’æ™‚ã«é©åˆ‡ãªå¯¾ç­–ãŒå¿…è¦

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### timestampè§£æã‚¨ãƒ©ãƒ¼
```
âš ï¸  è­¦å‘Š: 5ä»¶ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—è§£æã‚¨ãƒ©ãƒ¼
```
â†’ CSVå†…ã®æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç¢ºèªã€‚ISO8601å½¢å¼ã‚’æ¨å¥¨ã€‚

### ç‚ä¸ŠæœŸé–“ã«è©²å½“ãªã—
```
æœŸé–“ 1 (äº‹ä¾‹1): è©²å½“ãƒ¬ã‚³ãƒ¼ãƒ‰ãªã—
```
â†’ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ—¥æ™‚ã¨CSVã®æ—¥æ™‚ç¯„å›²ãŒåˆã£ã¦ã„ã‚‹ã‹ç¢ºèªã€‚

### å…¨ã¦ is_controversy=0
```
å…¨ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã« is_controversy=0 ã‚’ä»˜ä¸
```
â†’ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ç‚ä¸ŠæœŸé–“ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã€‚

## ğŸ“ ä»Šå¾Œã®æ‹¡å¼µ

- [ ] åŠè‡ªå‹•ãƒ©ãƒ™ãƒªãƒ³ã‚°ï¼ˆé–¾å€¤ãƒ™ãƒ¼ã‚¹ï¼‰
- [ ] ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ©ãƒ™ãƒªãƒ³ã‚°UI
- [ ] ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°
- [ ] è¤‡æ•°ãƒ©ãƒ™ãƒ«å¯¾å¿œï¼ˆç‚ä¸Šãƒ¬ãƒ™ãƒ«ï¼šhigh/medium/lowï¼‰
