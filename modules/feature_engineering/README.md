# Feature Engineeringï¼ˆç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ï¼‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

æ„Ÿæƒ…åˆ†æã¨ç«‹å ´åˆ†é¡ã®çµæœã‚’çµ±åˆã—ã€ç‚ä¸Šåˆ¤å®šç”¨ã®ç‰¹å¾´é‡ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

## ğŸ“‚ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
feature_engineering/
â”œâ”€â”€ feature_builder.py      # ç‰¹å¾´é‡çµ±åˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ outputs/                # å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€
â”‚   â”œâ”€â”€ æ¾æœ¬äººå¿—/
â”‚   â”‚   â””â”€â”€ æ¾æœ¬äººå¿—_feature_table.csv
â”‚   â”œâ”€â”€ å°æ¹¾æœ‰äº‹/
â”‚   â”‚   â””â”€â”€ å°æ¹¾æœ‰äº‹_feature_table.csv
â”‚   â””â”€â”€ ...
â””â”€â”€ README.md               # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸ¯ æ©Ÿèƒ½

### ç‰¹å¾´é‡çµ±åˆ (`feature_builder.py`)

æ„Ÿæƒ…åˆ†æã®æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã¨ç«‹å ´åˆ†é¡ã®çµæœã‚’çµåˆã—ã€ä»¥ä¸‹ã®ç‰¹å¾´é‡ã‚’ç”Ÿæˆ:

**åŸºæœ¬ç‰¹å¾´é‡:**
- `volume` - æ™‚é–“ã‚ãŸã‚Šã®ãƒ„ã‚¤ãƒ¼ãƒˆæ•°
- `negative_rate` - ãƒã‚¬ãƒ†ã‚£ãƒ–ç‡ï¼ˆæ„Ÿæƒ…åˆ†æï¼‰
- `stance_against_rate` - AGAINSTç‡
- `stance_favor_rate` - FAVORç‡
- `stance_neutral_rate` - NEUTRALç‡
- `sentiment_avg_score` - æ„Ÿæƒ…ã‚¹ã‚³ã‚¢å¹³å‡

**å·®åˆ†ç‰¹å¾´é‡:**
- `delta_volume` - å‰æ™‚é–“ã¨ã®æŠ•ç¨¿æ•°å·®
- `delta_negative_rate` - å‰æ™‚é–“ã¨ã®ãƒã‚¬ãƒ†ã‚£ãƒ–ç‡å·®
- `delta_against_rate` - å‰æ™‚é–“ã¨ã®AGAINSTç‡å·®
- `delta_volume_rate` - æŠ•ç¨¿æ•°å¤‰åŒ–ç‡

**ç¢ºç‡å¹³å‡:**
- `stance_against_mean` - AGAINSTç¢ºç‡ã®å¹³å‡
- `stance_favor_mean` - FAVORç¢ºç‡ã®å¹³å‡
- `stance_neutral_mean` - NEUTRALç¢ºç‡ã®å¹³å‡

## ğŸš€ ä½¿ã„æ–¹

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```bash
cd modules/feature_engineering

python feature_builder.py \
  --sentiment_csv <æ„Ÿæƒ…åˆ†æã®æ™‚ç³»åˆ—CSV> \
  --stance_csv <ç«‹å ´åˆ†é¡ã®çµæœCSV> \
  --output_csv <å‡ºåŠ›å…ˆCSV>
```

### å…·ä½“ä¾‹

```bash
# æ¾æœ¬äººå¿—ã®ãƒ‡ãƒ¼ã‚¿ã§ç‰¹å¾´é‡ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆ
python feature_builder.py \
  --sentiment_csv ../sentiment_analysis/dictionary_based/outputs/æ¾æœ¬äººå¿—_sentiment_1h.csv \
  --stance_csv ../stance_detection/outputs/æ¾æœ¬äººå¿—_stance.csv \
  --output_csv outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_feature_table.csv

# å°æ¹¾æœ‰äº‹ã®ãƒ‡ãƒ¼ã‚¿ã§ç‰¹å¾´é‡ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆ
python feature_builder.py \
  --sentiment_csv ../sentiment_analysis/dictionary_based/outputs/å°æ¹¾æœ‰äº‹_sentiment_1h.csv \
  --stance_csv ../stance_detection/outputs/å°æ¹¾æœ‰äº‹_stance.csv \
  --output_csv outputs/å°æ¹¾æœ‰äº‹/å°æ¹¾æœ‰äº‹_feature_table.csv
```

### å‡ºåŠ›ãƒ‘ã‚¹çœç•¥

`--output_csv` ã‚’çœç•¥ã™ã‚‹ã¨ã€å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒˆãƒ”ãƒƒã‚¯åã‚’è‡ªå‹•æŠ½å‡ºã—ã¦ä¿å­˜:

```bash
python feature_builder.py \
  --sentiment_csv ../sentiment_analysis/dictionary_based/outputs/æ¾æœ¬äººå¿—_sentiment_1h.csv \
  --stance_csv ../stance_detection/outputs/æ¾æœ¬äººå¿—_stance.csv

# è‡ªå‹•çš„ã« outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_feature_table.csv ã«ä¿å­˜
```

## ğŸ“‹ å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### æ„Ÿæƒ…åˆ†æCSVï¼ˆå¿…é ˆåˆ—ï¼‰

```csv
timestamp,count,negative_rate,avg_score
2025-11-02 12:00:00,10,0.7,-0.5
2025-11-02 13:00:00,15,0.8,-0.6
```

- `timestamp` ã¾ãŸã¯ `time` - æ—¥æ™‚ï¼ˆ1æ™‚é–“å˜ä½ï¼‰
- `count` - ãƒ„ã‚¤ãƒ¼ãƒˆæ•°
- `negative_rate` - ãƒã‚¬ãƒ†ã‚£ãƒ–ç‡ï¼ˆ0ã€œ1ï¼‰
- `avg_score` - å¹³å‡æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### ç«‹å ´åˆ†é¡CSVï¼ˆå¿…é ˆåˆ—ï¼‰

```csv
created_at,content,stance_label,stance_against,stance_favor,stance_neutral
2025-11-02T12:30:00.000Z,ãƒ„ã‚¤ãƒ¼ãƒˆå†…å®¹,AGAINST,0.8,0.1,0.1
2025-11-02T12:45:00.000Z,ãƒ„ã‚¤ãƒ¼ãƒˆå†…å®¹,FAVOR,0.1,0.7,0.2
```

- `created_at`, `date`, ã¾ãŸã¯ `timestamp` - ãƒ„ã‚¤ãƒ¼ãƒˆæ—¥æ™‚
- `stance_label` - ç«‹å ´ãƒ©ãƒ™ãƒ«ï¼ˆAGAINST/FAVOR/NEUTRALï¼‰
- `stance_against` - AGAINSTç¢ºç‡ï¼ˆ0ã€œ1ï¼‰
- `stance_favor` - FAVORç¢ºç‡ï¼ˆ0ã€œ1ï¼‰
- `stance_neutral` - NEUTRALç¢ºç‡ï¼ˆ0ã€œ1ï¼‰

## ğŸ“Š å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```csv
timestamp,volume,negative_rate,stance_against_rate,stance_favor_rate,stance_neutral_rate,delta_volume,delta_negative_rate,delta_against_rate,delta_volume_rate,sentiment_avg_score,stance_against_mean,stance_favor_mean,stance_neutral_mean
2025-11-02 12:00:00,10,0.7,0.5,0.3,0.2,0,0.0,0.0,0.0,-0.5,0.52,0.28,0.20
2025-11-02 13:00:00,25,0.8,0.6,0.2,0.2,15,0.1,0.1,1.5,-0.6,0.61,0.21,0.18
```

## ğŸ”§ å‡¦ç†ãƒ•ãƒ­ãƒ¼

1. **æ„Ÿæƒ…åˆ†æãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿** - æ™‚ç³»åˆ—åŒ–æ¸ˆã¿CSVã‚’èª­ã¿è¾¼ã¿
2. **ç«‹å ´åˆ†é¡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿** - ãƒ„ã‚¤ãƒ¼ãƒˆå˜ä½ã®CSVã‚’èª­ã¿è¾¼ã¿
3. **1æ™‚é–“å˜ä½ã«é›†è¨ˆ** - ç«‹å ´åˆ†é¡ã‚’1æ™‚é–“ã”ã¨ã«é›†è¨ˆ
4. **ãƒ‡ãƒ¼ã‚¿çµåˆ** - timestamp ã‚’ã‚­ãƒ¼ã«çµåˆ
5. **ç‰¹å¾´é‡ç”Ÿæˆ** - å·®åˆ†ãƒ»å¤‰åŒ–ç‡ãªã©ã‚’è¨ˆç®—
6. **æ¬ æå€¤å‡¦ç†** - 0ã§åŸ‹ã‚ã‚‹
7. **çµ±è¨ˆæƒ…å ±è¡¨ç¤º** - å¹³å‡å€¤ãƒ»æœ€å¤§å€¤ãªã©ã‚’è¡¨ç¤º
8. **CSVä¿å­˜** - ãƒˆãƒ”ãƒƒã‚¯åˆ¥ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜

## ğŸ“ˆ çµ±è¨ˆæƒ…å ±

ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ™‚ã«ä»¥ä¸‹ã®çµ±è¨ˆæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™:

```
============================================================
ğŸ“Š ç‰¹å¾´é‡ãƒ†ãƒ¼ãƒ–ãƒ«çµ±è¨ˆ
============================================================

ğŸ“ˆ åŸºæœ¬æƒ…å ±:
  ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°: 48ä»¶
  æœŸé–“: 2025-11-02 00:00:00 ã€œ 2025-11-04 00:00:00

ğŸ“Š å¹³å‡å€¤:
  å¹³å‡æŠ•ç¨¿æ•°: 2.02ä»¶/æ™‚é–“
  å¹³å‡ãƒã‚¬ãƒ†ã‚£ãƒ–ç‡: 98.96%
  å¹³å‡AGAINSTç‡: 18.56%
  å¹³å‡FAVORç‡: 63.92%

ğŸš€ æœ€å¤§å€¤:
  æœ€å¤§æŠ•ç¨¿æ•°: 10ä»¶ (2025-11-02 13:00:00)
  æœ€å¤§æŠ•ç¨¿æ€¥å¢—: +8ä»¶ (2025-11-02 13:00:00)
  æœ€å¤§æŠ•ç¨¿æ€¥å¢—ç‡: 400.0% (2025-11-02 13:00:00)
  æœ€å¤§ãƒã‚¬ãƒ†ã‚£ãƒ–ç‡: 100.0% (2025-11-02 12:00:00)
```

## âš ï¸ æ³¨æ„äº‹é …

- æ„Ÿæƒ…åˆ†æCSVã¯æ—¢ã«1æ™‚é–“å˜ä½ã§é›†è¨ˆã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
- ç«‹å ´åˆ†é¡CSVã¯å…ƒã®ãƒ„ã‚¤ãƒ¼ãƒˆå˜ä½ã®ãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
- æ—¥æ™‚ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯å•ã„ã¾ã›ã‚“ï¼ˆUTCæ¨å¥¨ï¼‰
- ãƒãƒ¼ã‚¸å¾Œã®æ¬ æå€¤ã¯å…¨ã¦0ã§åŸ‹ã‚ã‚‰ã‚Œã¾ã™
- å‡ºåŠ›ã¯ timestamp æ˜‡é †ã§ã‚½ãƒ¼ãƒˆã•ã‚Œã¾ã™

## ğŸ”„ å®Œå…¨ãªåˆ†æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä¾‹

```bash
# 1. æ„Ÿæƒ…åˆ†æï¼ˆæ™‚ç³»åˆ—é›†è¨ˆä»˜ãï¼‰
cd ../sentiment_analysis/dictionary_based
python analyze.py

# 2. ç«‹å ´åˆ†é¡
cd ../../stance_detection
python predict.py \
  ../../data/original/æ¾æœ¬äººå¿—/tweets_æ¾æœ¬äººå¿—.csv \
  outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_stance.csv

# 3. ç‰¹å¾´é‡çµ±åˆ
cd ../feature_engineering
python feature_builder.py \
  --sentiment_csv ../sentiment_analysis/dictionary_based/outputs/æ¾æœ¬äººå¿—_sentiment_1h.csv \
  --stance_csv ../stance_detection/outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_stance.csv

# 4. ç‚ä¸Šåˆ¤å®šï¼ˆæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
# outputs/æ¾æœ¬äººå¿—/æ¾æœ¬äººå¿—_feature_table.csv ã‚’ä½¿ç”¨
```

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### åˆ—ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼
```
ValueError: æ„Ÿæƒ…åˆ†æCSVã« 'timestamp' åˆ—ãŒå¿…è¦ã§ã™
```
â†’ å…¥åŠ›CSVã®ã‚«ãƒ©ãƒ åã‚’ç¢ºèªã—ã¦ãã ã•ã„

### æ™‚åˆ»ã®å½¢å¼ã‚¨ãƒ©ãƒ¼
```
ParserError: Unable to parse datetime
```
â†’ æ—¥æ™‚åˆ—ãŒ ISO 8601 å½¢å¼ï¼ˆä¾‹: 2025-11-02T12:00:00ï¼‰ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

### å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ãŒãªã„ã‚¨ãƒ©ãƒ¼
â†’ è‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã¾ã™ã€‚æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## ğŸ“ ä»Šå¾Œã®æ‹¡å¼µ

- [ ] è¤‡æ•°ãƒˆãƒ”ãƒƒã‚¯ã®ä¸€æ‹¬å‡¦ç†
- [ ] ç§»å‹•å¹³å‡ãªã©ã®æ™‚ç³»åˆ—ç‰¹å¾´é‡è¿½åŠ 
- [ ] ç•°å¸¸æ¤œçŸ¥ç”¨ã®ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
- [ ] å¯è¦–åŒ–æ©Ÿèƒ½ï¼ˆã‚°ãƒ©ãƒ•å‡ºåŠ›ï¼‰
